# Open COBOL ESQL 4J

Open COBOL ESQL 4J (OCESQL 4J) consits of open-source Embedded SQL pre-compiler and run time libraries for [opensource COBOL 4J](https://github.com/opensourcecobol/opensourcecobol4j).

# Supported software versions

* opensource COBOL 4J
  * 1.1.2 or later
* PostgreSQL
  * 9.6
  * 15
* OS
  * Ubuntu 24.04
  * Almalinux 9
* Java
  * OpenJDK 11

# Installation and Usage

## Requirements

* Open-source database.
  OCESQL 4J currently supports PostgreSQL database only.

* [opensource COBOL 4j](https://github.com/opensourcecobol/opensourcecobol4j) v1.1.12 or later.

* [sbt](https://www.scala-sbt.org/).


## Installation (Linux)

### Install opensource COBOL 4J

See [Installation guides of opensource COBOL 4J](https://github.com/opensourcecobol/opensourcecobol4j/wiki).

### Download the content

Run the following commands to download Open COBOL ESQL 4J.

```sh
curl -L -o Open-COBOL-ESQL-4j-v1.1.1.tar.gz https://github.com/opensourcecobol/Open-COBOL-ESQL-4j/archive/refs/tags/v1.1.1.tar.gz
tar zxvf Open-COBOL-ESQL-4j-v1.1.1.tar.gz
# If you don't need the downloaded file, you can delete it.
rm Open-COBOL-ESQL-4j-v1.1.1.tar.gz
```

### Prepare jar files

You need 2 jar files.

#### `libcobj.jar`

Run the follwing commands.

```sh
cd Open-COBOL-ESQL-4j-1.1.1/
cp /usr/lib/opensourcecobol4j/libcobj.jar dblibj/lib/
```

If you have already installed opensource COBOL 4J, `/usr/lib/opensourcecobol4j/libcobj.jar` exists.
When you run `find /usr/lib/ -name libcobj.jar`, the above path should be displayed.

#### `postgresql.jar`

In addtion, run the following commands to prepare postgresql jdbc driver.
Some commands may lack permissions.
In such case, prefix them with `sudo`.

```sh
# Move to the root directory of Open-COBOL-ESQL-4j
cd Open-COBOL-ESQL-4j-1.1.1/
mkdir -p /usr/lib/Open-COBOL-ESQL-4j-1.1.1/
curl -L -o /usr/lib/Open-COBOL-ESQL-4j-1.1.1/postgresql.jar https://jdbc.postgresql.org/download/postgresql-42.2.24.jar
cp /usr/lib/Open-COBOL-ESQL-4j-1.1.1/postgresql.jar dblibj/lib
```

### sbt

See [the official Installation guide](https://www.scala-sbt.org/1.x/docs/Installing-sbt-on-Linux.html).

### Install Open COBOL ESQL 4J

Run the following commands.

```sh
./configure --prefix=/usr/
make
make install
```

### Set `$CLASSPATH`

Add `/usr/lib/Open-COBOL-ESQL-4j/ocesql4j.jar` and `/usr/lib/Open-COBOL-ESQL-4j/postgresql.jar` to $CLASSPATH.

```sh
export CLASSPATH="$CLASSPATH":/usr/lib/Open-COBOL-ESQL-4j/ocesql4j.jar:/usr/lib/Open-COBOL-ESQL-4j/postgresql.jar
```

## Installation (Windows)
### Install opensource COBOL 4J

See [README.md of opensource COBOL 4J](https://github.com/opensourcecobol/opensourcecobol4j/blob/develop/README.md).

### Prepare jar files
Copy "libcobj.jar", generated by the installation of opensourcecobol4j, into "dblibj\lib".
In addtion, execute the following command to prepare postgresql jdbc driver.
  
```powershell
cd Open-COBOL-ESQL-4J
mkdir C:\ocesql4j\lib
curl -L -o C:\ocesql4j\lib\postgresql.jar https://jdbc.postgresql.org/download/postgresql-42.2.24.jar
copy C:\ocesql4j\lib\postgresql.jar dblibj\lib
```

### sbt
Download [here](https://www.scala-sbt.org/download/) and install it.

### Install Open COBOL ESQL 4J
#### Install Visual Studio
The Windows version of Open COBOL ESQL 4J uses the CL compiler included in Visual Studio 2022, so you must have [Visual Studio](https://visualstudio.microsoft.com/) installed beforehand.


#### Build a solution file
1. Download the complete set of files for opensource COBOL 4J.
2. Open win/ocesql.sln with Visual Studio.
3. Select "Debug" or "Release" mode.
![alt text](image/readme1.png)
4. Click "Build" -> "Build Solution".
![alt text](image/readme2.png)
After the build is completed, "cobj.exe" will be created in `win\x64\Debug` or `win\x64\Release`.

#### Build Scala Files
2. Open PowerShell.

3. Move to "dblibj" directory.
   ```
    cd dblibj
   ```
4. Execute the following command.
   ```
   sbt assembly
   ```

#### Place files in the appropriate location
1. If you build in Debug mode, change the 5th line of "win\install.ps1" from `\x64\Release\cobj.exe` to `\x64\Debug\cobj.exe`.
2. Open PowerShell
3. Move to "win" directory and execute "install.ps1".  
    ```
    cd win
    .\install.ps1
    ```
* Each file is placed in the following location. 

    | File name | Location |
    |---|---|
    | ocesql.exe | C:\ocesql4j\bin |
    | ocesql4j.jar | C:\ocesql4j\lib |

*  If you want to change the location of the files, modify "install.ps1".

#### Set the environment variables
1. Add `C:\ocesql4j\bin` to "PATH".
2. Add `C:\ocesql4j\lib\ocesql4j.jar` and `C:\ocesql4j\lib\postgresql.jar` to "CLASSPATH".

# Contributing

Guidelines for contributing to Open COBOL ESQL 4J can be found in [CONTRIBUTING.md](./CONTRIBUTING.md).
Contributors are listed in https://github.com/opensourcecobol/Open-COBOL-ESQL-4j/graphs/contributors